{% extends 'layout.html' %}


{% block content %}
<div id="media-management">
<table class="table table-striped" id="media-files">
  <thead>
    <tr><th>Name</th><th>Size</th><th>Created</th><th>MD5</th><th></th></tr>
  </thead>
  <tbody>
    {% for med in media %}
    <tr><td>{{med.name}}</td>
      <td class="filesize">
        {% if med.blob %}
        {{med.blob.size|sizeFormat}}
        {% else %}
        <span class="bool-no ">&cross;</span>
        {% endif %}
      </td>
      <td class="created">
        {% if med.blob %}
        {{med.blob.creation|dateTimeFormat("%H:%M:%S %d/%m/%Y")}}
        {% else %}
        <span class="bool-no ">&cross;</span>
        {% endif %}
      </td>
      <td class="md5-hash">
        {% if med.blob %}
        {{med.blob.md5_hash}}
        {% else %}
        <span class="bool-no ">&cross;</span>
        {% endif %}
      </td>
      <td>
        {% if med.blob %}
        <button class="btn btn-danger btn-delete" data-key="{{med.key}}">Delete</button>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
    <tr><td class="error" colspan="4"></td></tr>
  </tbody>
</table>

<table class="table table-striped" id="keys">
  <thead><tr><th>KID</th><th>Key</th><th>Auto generated</th><th /></tr></thead>
  <tbody>
    {% for keypair in keys %}
    <tr>
      <td class="kid">{{keypair.KID.hex}}</td>
      <td class="key">{{keypair.KEY.hex}}</td>
      <td class="computed">
        {% if keypair.computed %}
        <span class="bool-yes %s">&check;</span>
        {% else %}
        <span class="bool-no ">&cross;</span>
        {% endif %}
      </td>
      <td><button class="btn btn-danger btn-delete">Delete</button></td>
    </tr>
    {% endfor %}
    <tr class="placeholder"><td class="kid"></td><td class="key"></td><td class="computed"></td><td><button class="btn
    btn-danger btn-delete">Delete</button></td></tr>
  </tbody>
  <tfoot>
    <tr>
      <td><input type="text" name="kid" /></td>
      <td><input type="text" name="key" placeholder="(autogenerated)"/></td>
      <td colspan="2"><button class="btn btn-success btn-add">Add</button></td>
    </tr>
    <tr><td class="error" colspan="3"></td></tr>
    </tfoot>
</table>
	<form class="form" action="{{upload_url}}" method="POST"
              enctype="multipart/form-data" id="upload-form">
		{{csrf_token}}
    	Upload File: <input type="file" name="file" accept="video/mp4,audio/mp4,.mp4"><br />
    	Media ID: <select name="media">
    	{% for repr in media_ids %}
    	<option value="{{repr}}">{{repr}}</option>
    	{% endfor %} 
    	</select>
    	<input type="submit" name="submit" value="Submit">
        </form>
</div>
{% endblock %}

{% block scripts %}
  {{import_script("jquery-1.11.1")}}
  <script src="/js/media.js" type="text/javascript"></script>
{% endblock %}
